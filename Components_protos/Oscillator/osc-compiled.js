"use strict";

var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var patch;
var equalTempered440;
window.onload = function () {
  equalTempered440 = [16.35, 17.32, 18.35, 19.45, 20.6, 21.83, 23.12, 24.5, 25.96, 27.5, 29.14, 30.87, 32.7, 34.65, 36.71, 38.89, 41.2, 43.65, 46.25, 49, 51.91, 55, 58.27, 61.74, 65.41, 69.3, 73.42, 77.78, 82.41, 87.31, 92.5, 98, 103.83, 110, 116.54, 123.47, 130.81, 138.59, 146.83, 155.56, 164.81, 174.61, 185, 196, 207.65, 220, 233.08, 246.94, 261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392, 415.3, 440, 466.16, 493.88, 523.25, 554.37, 587.33, 622.25, 659.25, 698.46, 739.99, 783.99, 830.61, 880, 932.33, 987.77, 1046.5, 1108.73, 1174.66, 1244.51, 1318.51, 1396.91, 1479.98, 1567.98, 1661.22, 1760, 1864.66, 1975.53, 2093, 2217.46, 2349.32, 2489.02, 2637.02, 2793.83, 2959.96, 3135.96, 3322.44, 3520, 3729.31, 3951.07, 4186.01, 4434.92, 4698.63, 4978.03, 5274.04, 5587.65, 5919.91, 6271.93, 6644.88, 7040, 7458.62, 7902.13];
  var ctx = new AudioContext();
  var active_voices = {};

  patch = new Patch();

  function onMIDIMessage(event) {
    console.log(event.data);
    var status = event.data[0];
    var note = event.data[1];
    var velocity = event.data[2] / 255; //normalize: velocity -> gain: [0,255] -> [0,1]
    var voice;
    if (status !== 144) {
      return; //mod wheel and pitch wheel break the synth - TODO: fix that
    }

    if (velocity > 0) {

      voice = new Voice(note, ctx);
      active_voices[note] = voice;
      voice.start(velocity);
    } else {
      active_voices[note].stop(ctx.currentTime + 3);
      delete active_voices[note];
    }
  }

  //Request midi accsess
  navigator.requestMIDIAccess().then(function (midiAccess) {
    console.log("MIDI ready!");
    var inputs = midiAccess.inputs.values();
    for (var input = inputs.next(); input && !input.done; input = inputs.next()) {
      input.value.onmidimessage = onMIDIMessage;
    }
  }, function (msg) {
    console.log("Failed to get MIDI access - ", msg);
  });

  //Initialize synth
  initSynth();

  //Initialize patch
  initPatch();
};

function initPatch() {
  var params = document.getElementsByClassName("parameter");
  [].forEach.call(params, function (v) {

    v.value = patch.getParameter(v.id);
    v.addEventListener("input", function (e) {
      //v.dispatchEvent(new Event('onmidimessage'));
      console.log(e.target.id, e.target.value);
      patch.setParameter(e.target.id, e.target.value);
    }, false);
  });
}

function initSynth() {
  var oscProto = Object.create(HTMLElement.prototype);

  oscProto.createdCallback = function () {
    var gainControl = HtmlControl.createSlider({
      id: this.id + "_gain",
      advanced: true,
      labelText: "Amp: ",
      min: 0,
      max: 1,
      step: 0.1,
      value: patch.getParameter(this.id + "_gain"),
      className: "slider"
    });

    var waveTypeControl = HtmlControl.createSelect({
      id: this.id + "_wave",
      labelText: "Wave Type: ",
      options: ["sine", "square", "triangle", "sawtooth"]
    });

    var pitchControl = HtmlControl.createNumericTextBox({
      id: this.id + "_pitch",
      labelText: "Pitch: ",
      min: -64,
      max: 64,
      value: 0
    });

    var powerControl = HtmlControl.createCheckBox({
      id: this.id + "_power",
      labelText: "On/Off: ",
      className: "power"
    });

    //on/off
    this.appendChild(powerControl.label);
    this.appendChild(powerControl.input);

    //gain control
    gainControl.label.setAttribute("for", this.id + "_gain");
    this.appendChild(gainControl.label);
    this.appendChild(gainControl.slider);
    this.appendChild(gainControl.valueIndicator);

    //wave type control
    this.appendChild(waveTypeControl.label);
    this.appendChild(waveTypeControl.select);

    //pitch control
    this.appendChild(pitchControl.label);
    this.appendChild(pitchControl.input);
  };
  document.registerElement("x-osc", { prototype: oscProto });
}

var Patch = (function () {
  function Patch() {
    _classCallCheck(this, Patch);

    this._patch = {
      Osc1_power: "on",
      Osc1_wave: "square",
      Osc1_pitch: 0,
      Osc1_gain: 0.8
    };
  }

  _createClass(Patch, [{
    key: "setParameter",
    value: function setParameter(parameter, value) {
      this._patch[parameter] = value;
    }
  }, {
    key: "getParameter",
    value: function getParameter(parameter) {
      return this._patch[parameter];
    }
  }]);

  return Patch;
})();

var Voice = (function () {
  function Voice(note, ctx) {
    _classCallCheck(this, Voice);

    this.note = note;
    this.ctx = ctx;
    this.oscillators = [];
  }

  _createClass(Voice, [{
    key: "start",
    value: function start(velocity) {
      var vco1 = new Oscillator(this.ctx);
      vco1.setType(patch.getParameter("Osc1_wave"));
      vco1.setGain(patch.getParameter("Osc1_gain") * velocity);
      var pitch = +patch.getParameter("Osc1_pitch");
      vco1.setFrequency(equalTempered440[this.note + pitch]);
      //console.log(this.frequency)
      vco1.start();
      this.oscillators.push(vco1);
    }
  }, {
    key: "stop",
    value: function stop() {
      var time = arguments[0] === undefined ? 0 : arguments[0];

      this.oscillators.forEach(function (oscillators) {
        oscillators.stop(time);
      });
    }
  }]);

  return Voice;
})();

var Oscillator = (function () {
  function Oscillator(ctx) {
    _classCallCheck(this, Oscillator);

    this.wave = "sine";
    this.gain = 1;
    this.pitch = 0;
    this.ctx = ctx;
    //create VCO (voltage controlled oscillator)
    this.vco = this.ctx.createOscillator();

    //create VCA (voltage controlled amplifier)
    this.vca = this.ctx.createGain();

    //vco->vca->destination
    this.vco.connect(this.vca);
    this.vca.connect(this.ctx.destination);
  }

  _createClass(Oscillator, [{
    key: "getType",

    //get/set wave type
    value: function getType() {
      return this.vco.type;
    }
  }, {
    key: "setType",
    value: function setType(wave) {
      this.vco.type = wave;
    }
  }, {
    key: "getGain",

    //get/set gain
    value: function getGain() {
      return this.vca.gain.value;
    }
  }, {
    key: "setGain",
    value: function setGain(value) {
      this.vca.gain.value = value;
      this.vca.gain.setTargetAtTime(0, this.ctx.currentTime, 0.5);
    }
  }, {
    key: "getPitch",

    //get/set pitch
    value: function getPitch() {
      return this.vco.detune.value;
    }
  }, {
    key: "setPitch",
    value: function setPitch(value) {
      this.vco.detune.value = value;
    }
  }, {
    key: "getFrequency",

    //get/set frequency
    value: function getFrequency() {
      return this.vco.frequency.value;
    }
  }, {
    key: "setFrequency",
    value: function setFrequency(value) {
      this.vco.frequency.value = value;
    }
  }, {
    key: "connect",

    //connect vca->external_node
    value: function connect(node) {
      this.vca.connect(node);
    }
  }, {
    key: "start",

    //start/stop
    value: function start() {
      var time = arguments[0] === undefined ? 0 : arguments[0];

      this.vco.start(time);
    }
  }, {
    key: "stop",
    value: function stop() {
      var time = arguments[0] === undefined ? 0 : arguments[0];

      this.vco.stop(time);
    }
  }]);

  return Oscillator;
})();

var HtmlControl = (function () {
  function HtmlControl() {
    _classCallCheck(this, HtmlControl);
  }

  _createClass(HtmlControl, null, [{
    key: "createSlider",

    //Slider control
    value: function createSlider() {
      var _ref = arguments[0] === undefined ? {} : arguments[0];

      var id = _ref.id;
      var _ref$className = _ref.className;
      var className = _ref$className === undefined ? "" : _ref$className;
      var labelText = _ref.labelText;
      var min = _ref.min;
      var max = _ref.max;
      var step = _ref.step;
      var value = _ref.value;
      var _ref$advanced = _ref.advanced;
      var advanced = _ref$advanced === undefined ? false : _ref$advanced;

      var valueIndicator;
      var label;
      var slider = document.createElement("input");

      //simple slider
      slider.setAttribute("type", "range");
      //slider.id = id;
      slider.className = "parameter" + " " + className;
      slider.min = min;
      slider.max = max;
      slider.step = step;
      slider.value = value;

      //advanced slider
      if (advanced) {
        //create html elements
        label = document.createElement("label");
        valueIndicator = document.createElement("input");
        valueIndicator.className = "parameter";

        //label
        label.textContent = labelText;

        //value indicator
        valueIndicator.id = id;
        valueIndicator.setAttribute("type", "number");
        valueIndicator.min = min;
        valueIndicator.max = max;
        valueIndicator.value = value;
        valueIndicator.step = step;
        valueIndicator.addEventListener("input", function (e) {
          slider.value = e.target.value;
        }, false);

        //slider
        slider.classList.remove("parameter");
        slider.addEventListener("input", function (e) {
          valueIndicator.value = e.target.value;
          valueIndicator.dispatchEvent(new MouseEvent("input"));
        }, false);

        return { slider: slider, label: label, valueIndicator: valueIndicator };
      }

      return { slider: slider };
    }
  }, {
    key: "createSelect",
    value: function createSelect() {
      var _ref2 = arguments[0] === undefined ? {} : arguments[0];

      var id = _ref2.id;
      var labelText = _ref2.labelText;
      var _ref2$options = _ref2.options;
      var options = _ref2$options === undefined ? [] : _ref2$options;

      var select = document.createElement("select");
      var label = document.createElement("label");
      select.id = id;
      select.className = "parameter";
      label.setAttribute("for", id);
      label.textContent = labelText;
      for (var i = 0; i < options.length; i++) {
        var option = select.appendChild(document.createElement("option"));
        option.value = options[i];
        option.innerHTML = options[i];
      }

      return { select: select, label: label };
    }
  }, {
    key: "createNumericTextBox",
    value: function createNumericTextBox() {
      var _ref3 = arguments[0] === undefined ? {} : arguments[0];

      var id = _ref3.id;
      var labelText = _ref3.labelText;
      var _ref3$min = _ref3.min;
      var min = _ref3$min === undefined ? 0 : _ref3$min;
      var _ref3$max = _ref3.max;
      var max = _ref3$max === undefined ? 1 : _ref3$max;
      var _ref3$value = _ref3.value;
      var value = _ref3$value === undefined ? 1 : _ref3$value;

      var input = document.createElement("input");
      var label = document.createElement("label");
      input.id = id;
      input.className = "parameter";
      input.setAttribute("type", "number");
      input.min = min;
      input.max = max;
      input.value = value;
      label.setAttribute("for", id);
      label.textContent = labelText;

      return { input: input, label: label };
    }
  }, {
    key: "createCheckBox",
    value: function createCheckBox() {
      var _ref4 = arguments[0] === undefined ? {} : arguments[0];

      var id = _ref4.id;
      var labelText = _ref4.labelText;
      var className = _ref4.className;

      var input = document.createElement("input");
      var label = document.createElement("label");

      input.id = id;
      input.className = className;
      input.setAttribute("type", "checkbox");

      label.setAttribute("for", id);
      label.innerHTML = labelText;

      return { input: input, label: label };
    }
  }]);

  return HtmlControl;
})();

//# sourceMappingURL=data:application/json;base64,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QUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztBQUM5QixXQUFLLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQzs7QUFFOUIsYUFBTyxFQUFDLEtBQUssRUFBTCxLQUFLLEVBQUUsS0FBSyxFQUFMLEtBQUssRUFBQyxDQUFDO0tBQ3ZCOzs7V0FHb0IsMEJBQWtDOytDQUFKLEVBQUU7O1VBQTlCLEVBQUUsU0FBRixFQUFFO1VBQUUsU0FBUyxTQUFULFNBQVM7VUFBRSxTQUFTLFNBQVQsU0FBUzs7QUFDN0MsVUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM1QyxVQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDOztBQUU1QyxXQUFLLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztBQUNkLFdBQUssQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0FBQzVCLFdBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDOztBQUV2QyxXQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztBQUM5QixXQUFLLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQzs7QUFFNUIsYUFBTyxFQUFDLEtBQUssRUFBTCxLQUFLLEVBQUUsS0FBSyxFQUFMLEtBQUssRUFBQyxDQUFDO0tBRXZCOzs7U0FwR0csV0FBVyIsImZpbGUiOiJvc2MtY29tcGlsZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbnZhciBwYXRjaDtcbnZhciBlcXVhbFRlbXBlcmVkNDQwO1xud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICBlcXVhbFRlbXBlcmVkNDQwID0gWzE2LjM1LCAxNy4zMiwgMTguMzUsIDE5LjQ1LCAyMC42MCwgMjEuODMsIDIzLjEyLCAyNC41MCwgMjUuOTYsIDI3LjUwLCAyOS4xNCwgMzAuODcsIDMyLjcwLCAzNC42NSwgMzYuNzEsIDM4Ljg5LCA0MS4yMCwgNDMuNjUsIDQ2LjI1LCA0OSwgNTEuOTEsIDU1LCA1OC4yNywgNjEuNzQsIDY1LjQxLCA2OS4zLCA3My40MiwgNzcuNzgsIDgyLjQxLCA4Ny4zMSwgOTIuNSwgOTgsIDEwMy44MywgMTEwLCAxMTYuNTQsIDEyMy40NywgMTMwLjgxLCAxMzguNTksIDE0Ni44MywgMTU1LjU2LCAxNjQuODEsIDE3NC42MSwgMTg1LCAxOTYsIDIwNy42NSwgMjIwLCAyMzMuMDgsIDI0Ni45NCwgMjYxLjYzLCAyNzcuMTgsIDI5My42NiwgMzExLjEzLCAzMjkuNjMsIDM0OS4yMywgMzY5Ljk5LCAzOTIsIDQxNS4zLCA0NDAsIDQ2Ni4xNiwgNDkzLjg4LCA1MjMuMjUsIDU1NC4zNywgNTg3LjMzLCA2MjIuMjUsIDY1OS4yNSwgNjk4LjQ2LCA3MzkuOTksIDc4My45OSwgODMwLjYxLCA4ODAsIDkzMi4zMywgOTg3Ljc3LCAxMDQ2LjUwLCAxMTA4LjczLCAxMTc0LjY2LCAxMjQ0LjUxLCAxMzE4LjUxLCAxMzk2LjkxLCAxNDc5Ljk4LCAxNTY3Ljk4LCAxNjYxLjIyLCAxNzYwLCAxODY0LjY2LCAxOTc1LjUzLCAyMDkzLCAyMjE3LjQ2LCAyMzQ5LjMyLCAyNDg5LjAyLCAyNjM3LjAyLCAyNzkzLjgzLCAyOTU5Ljk2LCAzMTM1Ljk2LCAzMzIyLjQ0LCAzNTIwLCAzNzI5LjMxLCAzOTUxLjA3LCA0MTg2LjAxLCA0NDM0LjkyLCA0Njk4LjYzLCA0OTc4LjAzLCA1Mjc0LjA0LCA1NTg3LjY1LCA1OTE5LjkxLCA2MjcxLjkzLCA2NjQ0Ljg4LCA3MDQwLCA3NDU4LjYyLCA3OTAyLjEzXTtcblx0dmFyIGN0eCA9IG5ldyBBdWRpb0NvbnRleHQoKTtcbiAgdmFyIGFjdGl2ZV92b2ljZXMgPSB7fTtcblxuICBwYXRjaCA9IG5ldyBQYXRjaCgpO1xuXG4gIGZ1bmN0aW9uIG9uTUlESU1lc3NhZ2UoZXZlbnQpIHtcbiAgICBjb25zb2xlLmxvZyhldmVudC5kYXRhKTtcbiAgICB2YXIgc3RhdHVzID0gZXZlbnQuZGF0YVswXTtcbiAgICB2YXIgbm90ZSA9IGV2ZW50LmRhdGFbMV07XG4gICAgdmFyIHZlbG9jaXR5ID0gZXZlbnQuZGF0YVsyXS8yNTU7IC8vbm9ybWFsaXplOiB2ZWxvY2l0eSAtPiBnYWluOiBbMCwyNTVdIC0+IFswLDFdXG4gICAgdmFyIHZvaWNlO1xuICAgIGlmKHN0YXR1cyAhPT0gMTQ0KSB7XG4gICAgICByZXR1cm47IC8vbW9kIHdoZWVsIGFuZCBwaXRjaCB3aGVlbCBicmVhayB0aGUgc3ludGggLSBUT0RPOiBmaXggdGhhdFxuICAgIH1cblxuICAgIGlmKHZlbG9jaXR5ID4gMCkge1xuXG4gICAgICB2b2ljZSA9IG5ldyBWb2ljZShub3RlLCBjdHgpO1xuICAgICAgYWN0aXZlX3ZvaWNlc1tub3RlXSA9IHZvaWNlO1xuICAgICAgdm9pY2Uuc3RhcnQodmVsb2NpdHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhY3RpdmVfdm9pY2VzW25vdGVdLnN0b3AoY3R4LmN1cnJlbnRUaW1lICsgMyk7XG4gICAgICBkZWxldGUgYWN0aXZlX3ZvaWNlc1tub3RlXTtcbiAgICB9XG4gIH1cblxuICAvL1JlcXVlc3QgbWlkaSBhY2NzZXNzXG4gIG5hdmlnYXRvci5yZXF1ZXN0TUlESUFjY2VzcygpLnRoZW4oZnVuY3Rpb24obWlkaUFjY2Vzcykge1xuICAgIGNvbnNvbGUubG9nKFwiTUlESSByZWFkeSFcIik7XG4gICAgdmFyIGlucHV0cyA9IG1pZGlBY2Nlc3MuaW5wdXRzLnZhbHVlcygpO1xuICAgIGZvciAodmFyIGlucHV0ID0gaW5wdXRzLm5leHQoKSA7IGlucHV0ICYmICFpbnB1dC5kb25lOyBpbnB1dCA9IGlucHV0cy5uZXh0KCkpIHtcbiAgICAgIGlucHV0LnZhbHVlLm9ubWlkaW1lc3NhZ2UgPSBvbk1JRElNZXNzYWdlO1xuICAgIH1cbiAgfSwgZnVuY3Rpb24obXNnKXtcbiAgICBjb25zb2xlLmxvZyhcIkZhaWxlZCB0byBnZXQgTUlESSBhY2Nlc3MgLSBcIiwgbXNnKTtcbiAgfSk7XG5cbiAgLy9Jbml0aWFsaXplIHN5bnRoXG4gIGluaXRTeW50aCgpO1xuXG4gIC8vSW5pdGlhbGl6ZSBwYXRjaFxuICBpbml0UGF0Y2goKTtcbn07XG5cbmZ1bmN0aW9uIGluaXRQYXRjaCgpIHtcbiAgdmFyIHBhcmFtcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BhcmFtZXRlcicpO1xuICBbXS5mb3JFYWNoLmNhbGwocGFyYW1zLCBmdW5jdGlvbih2KXtcblxuXG4gICAgdi52YWx1ZSA9IHBhdGNoLmdldFBhcmFtZXRlcih2LmlkKTtcbiAgICB2LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgZnVuY3Rpb24gKGUpe1xuICAgICAgLy92LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdvbm1pZGltZXNzYWdlJykpO1xuICAgICAgY29uc29sZS5sb2coZS50YXJnZXQuaWQsIGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgIHBhdGNoLnNldFBhcmFtZXRlcihlLnRhcmdldC5pZCwgZS50YXJnZXQudmFsdWUpO1xuXG4gICAgfSwgZmFsc2UpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaW5pdFN5bnRoKCkge1xuICB2YXIgb3NjUHJvdG8gPSBPYmplY3QuY3JlYXRlKEhUTUxFbGVtZW50LnByb3RvdHlwZSk7XG5cbiAgb3NjUHJvdG8uY3JlYXRlZENhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGdhaW5Db250cm9sID0gSHRtbENvbnRyb2wuY3JlYXRlU2xpZGVyKHtcbiAgICAgIGlkOiB0aGlzLmlkICsgJ19nYWluJyxcbiAgICAgIGFkdmFuY2VkOiB0cnVlLFxuICAgICAgbGFiZWxUZXh0OiAnQW1wOiAnLFxuICAgICAgbWluOiAwLFxuICAgICAgbWF4OiAxLFxuICAgICAgc3RlcDogMC4xLFxuICAgICAgdmFsdWU6IHBhdGNoLmdldFBhcmFtZXRlcih0aGlzLmlkICsgJ19nYWluJyksXG4gICAgICBjbGFzc05hbWU6ICdzbGlkZXInXG4gICAgfSk7XG5cbiAgICB2YXIgd2F2ZVR5cGVDb250cm9sID0gSHRtbENvbnRyb2wuY3JlYXRlU2VsZWN0KHtcbiAgICAgIGlkOiB0aGlzLmlkICsgJ193YXZlJyxcbiAgICAgIGxhYmVsVGV4dDogJ1dhdmUgVHlwZTogJyxcbiAgICAgIG9wdGlvbnM6IFsnc2luZScsICdzcXVhcmUnLCAndHJpYW5nbGUnLCAnc2F3dG9vdGgnXVxuICAgIH0pO1xuXG4gICAgdmFyIHBpdGNoQ29udHJvbCA9IEh0bWxDb250cm9sLmNyZWF0ZU51bWVyaWNUZXh0Qm94KHtcbiAgICAgICAgaWQ6IHRoaXMuaWQgKyAnX3BpdGNoJyxcbiAgICAgICAgbGFiZWxUZXh0OiAnUGl0Y2g6ICcsXG4gICAgICAgIG1pbjogLTY0LFxuICAgICAgICBtYXg6IDY0LFxuICAgICAgICB2YWx1ZTogMFxuICAgIH0pO1xuXG4gICAgdmFyIHBvd2VyQ29udHJvbCA9IEh0bWxDb250cm9sLmNyZWF0ZUNoZWNrQm94KHtcbiAgICAgIGlkOiB0aGlzLmlkICsgJ19wb3dlcicsXG4gICAgICBsYWJlbFRleHQ6ICdPbi9PZmY6ICcsXG4gICAgICBjbGFzc05hbWU6ICdwb3dlcidcbiAgICB9KTtcblxuICAgIC8vb24vb2ZmXG4gICAgdGhpcy5hcHBlbmRDaGlsZChwb3dlckNvbnRyb2wubGFiZWwpO1xuICAgIHRoaXMuYXBwZW5kQ2hpbGQocG93ZXJDb250cm9sLmlucHV0KTtcblxuICAgIC8vZ2FpbiBjb250cm9sXG4gICAgZ2FpbkNvbnRyb2wubGFiZWwuc2V0QXR0cmlidXRlKCdmb3InLCB0aGlzLmlkICsgJ19nYWluJyk7XG4gICAgdGhpcy5hcHBlbmRDaGlsZChnYWluQ29udHJvbC5sYWJlbCk7XG4gICAgdGhpcy5hcHBlbmRDaGlsZChnYWluQ29udHJvbC5zbGlkZXIpO1xuICAgIHRoaXMuYXBwZW5kQ2hpbGQoZ2FpbkNvbnRyb2wudmFsdWVJbmRpY2F0b3IpO1xuXG4gICAgLy93YXZlIHR5cGUgY29udHJvbFxuICAgIHRoaXMuYXBwZW5kQ2hpbGQod2F2ZVR5cGVDb250cm9sLmxhYmVsKTtcbiAgICB0aGlzLmFwcGVuZENoaWxkKHdhdmVUeXBlQ29udHJvbC5zZWxlY3QpO1xuXG4gICAgLy9waXRjaCBjb250cm9sXG4gICAgdGhpcy5hcHBlbmRDaGlsZChwaXRjaENvbnRyb2wubGFiZWwpO1xuICAgIHRoaXMuYXBwZW5kQ2hpbGQocGl0Y2hDb250cm9sLmlucHV0KVxuICB9O1xuICBkb2N1bWVudC5yZWdpc3RlckVsZW1lbnQoJ3gtb3NjJywge3Byb3RvdHlwZTogb3NjUHJvdG99KTtcbn1cblxuY2xhc3MgUGF0Y2gge1xuICBjb25zdHJ1Y3Rvcigpe1xuICAgIHRoaXMuX3BhdGNoID0ge1xuICAgICAgJ09zYzFfcG93ZXInOiAnb24nLFxuICAgICAgJ09zYzFfd2F2ZSc6ICdzcXVhcmUnLFxuICAgICAgJ09zYzFfcGl0Y2gnOiAwLFxuICAgICAgJ09zYzFfZ2Fpbic6IC44XG4gICAgfVxuICB9XG5cbiAgc2V0UGFyYW1ldGVyKHBhcmFtZXRlciwgdmFsdWUpIHtcbiAgICB0aGlzLl9wYXRjaFtwYXJhbWV0ZXJdID0gdmFsdWU7XG4gIH1cblxuICBnZXRQYXJhbWV0ZXIocGFyYW1ldGVyKSB7XG4gICAgcmV0dXJuIHRoaXMuX3BhdGNoW3BhcmFtZXRlcl07XG4gIH1cbn1cblxuY2xhc3MgVm9pY2Uge1xuICBjb25zdHJ1Y3Rvcihub3RlLCBjdHgpIHtcbiAgICB0aGlzLm5vdGUgPSBub3RlO1xuICAgIHRoaXMuY3R4ID0gY3R4O1xuICAgIHRoaXMub3NjaWxsYXRvcnMgPSBbXTtcbiAgfVxuXG4gIHN0YXJ0KHZlbG9jaXR5KSB7XG4gICAgdmFyIHZjbzEgPSBuZXcgT3NjaWxsYXRvcih0aGlzLmN0eCk7XG4gICAgdmNvMS5zZXRUeXBlKHBhdGNoLmdldFBhcmFtZXRlcignT3NjMV93YXZlJykpO1xuICAgIHZjbzEuc2V0R2FpbihwYXRjaC5nZXRQYXJhbWV0ZXIoJ09zYzFfZ2FpbicpICogdmVsb2NpdHkpO1xuICAgIHZhciBwaXRjaCA9ICtwYXRjaC5nZXRQYXJhbWV0ZXIoJ09zYzFfcGl0Y2gnKTtcbiAgICB2Y28xLnNldEZyZXF1ZW5jeShlcXVhbFRlbXBlcmVkNDQwW3RoaXMubm90ZSArIHBpdGNoXSk7XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLmZyZXF1ZW5jeSlcbiAgICB2Y28xLnN0YXJ0KCk7XG4gICAgdGhpcy5vc2NpbGxhdG9ycy5wdXNoKHZjbzEpO1xuICB9XG5cbiAgc3RvcCh0aW1lPTApIHtcbiAgICB0aGlzLm9zY2lsbGF0b3JzLmZvckVhY2goZnVuY3Rpb24ob3NjaWxsYXRvcnMpe1xuICAgICAgb3NjaWxsYXRvcnMuc3RvcCh0aW1lKTtcbiAgICB9KTtcbiAgfVxufVxuXG5jbGFzcyBPc2NpbGxhdG9yIHtcbiAgY29uc3RydWN0b3IoY3R4KSB7XG4gICAgdGhpcy53YXZlID0gJ3NpbmUnO1xuICAgIHRoaXMuZ2FpbiA9IDE7XG4gICAgdGhpcy5waXRjaCA9IDA7XG4gICAgdGhpcy5jdHggPSBjdHg7XG4gICAgLy9jcmVhdGUgVkNPICh2b2x0YWdlIGNvbnRyb2xsZWQgb3NjaWxsYXRvcilcbiAgICB0aGlzLnZjbyA9IHRoaXMuY3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTtcblxuICAgIC8vY3JlYXRlIFZDQSAodm9sdGFnZSBjb250cm9sbGVkIGFtcGxpZmllcilcbiAgICB0aGlzLnZjYSA9IHRoaXMuY3R4LmNyZWF0ZUdhaW4oKTtcblxuICAgIC8vdmNvLT52Y2EtPmRlc3RpbmF0aW9uXG4gICAgdGhpcy52Y28uY29ubmVjdCh0aGlzLnZjYSk7XG4gICAgdGhpcy52Y2EuY29ubmVjdCh0aGlzLmN0eC5kZXN0aW5hdGlvbik7XG4gIH1cblxuICAvL2dldC9zZXQgd2F2ZSB0eXBlXG4gIGdldFR5cGUoKSB7XG4gICAgcmV0dXJuIHRoaXMudmNvLnR5cGU7XG4gIH1cbiAgc2V0VHlwZSh3YXZlKSB7XG4gICAgdGhpcy52Y28udHlwZSA9IHdhdmU7XG4gIH1cblxuICAvL2dldC9zZXQgZ2FpblxuICBnZXRHYWluKCkge1xuICAgIHJldHVybiB0aGlzLnZjYS5nYWluLnZhbHVlO1xuICB9XG4gIHNldEdhaW4odmFsdWUpIHtcbiAgICB0aGlzLnZjYS5nYWluLnZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy52Y2EuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoMCwgdGhpcy5jdHguY3VycmVudFRpbWUsIC41KTtcbiAgfVxuXG4gIC8vZ2V0L3NldCBwaXRjaFxuICBnZXRQaXRjaCgpIHtcbiAgICByZXR1cm4gdGhpcy52Y28uZGV0dW5lLnZhbHVlO1xuICB9XG4gIHNldFBpdGNoKHZhbHVlKSB7XG4gICAgdGhpcy52Y28uZGV0dW5lLnZhbHVlID0gdmFsdWU7XG4gIH1cblxuICAvL2dldC9zZXQgZnJlcXVlbmN5XG4gIGdldEZyZXF1ZW5jeSgpIHtcbiAgICByZXR1cm4gdGhpcy52Y28uZnJlcXVlbmN5LnZhbHVlO1xuICB9XG4gIHNldEZyZXF1ZW5jeSh2YWx1ZSkge1xuICAgIHRoaXMudmNvLmZyZXF1ZW5jeS52YWx1ZSA9IHZhbHVlO1xuICB9XG5cbiAgLy9jb25uZWN0IHZjYS0+ZXh0ZXJuYWxfbm9kZVxuICBjb25uZWN0KG5vZGUpIHtcbiAgICB0aGlzLnZjYS5jb25uZWN0KG5vZGUpO1xuICB9XG5cbiAgLy9zdGFydC9zdG9wXG4gIHN0YXJ0KHRpbWU9MCkge1xuICAgIHRoaXMudmNvLnN0YXJ0KHRpbWUpO1xuICB9XG4gIHN0b3AodGltZT0wKSB7XG4gICAgdGhpcy52Y28uc3RvcCh0aW1lKTtcbiAgfVxufVxuXG5jbGFzcyBIdG1sQ29udHJvbCB7XG4gIC8vU2xpZGVyIGNvbnRyb2xcbiAgc3RhdGljIGNyZWF0ZVNsaWRlcih7aWQsIGNsYXNzTmFtZT0nJywgbGFiZWxUZXh0LCBtaW4sIG1heCwgc3RlcCwgdmFsdWUsIGFkdmFuY2VkPWZhbHNlfSA9IHt9KSB7XG4gICAgdmFyIHZhbHVlSW5kaWNhdG9yO1xuICAgIHZhciBsYWJlbDtcbiAgICB2YXIgc2xpZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcblxuXG4gICAgLy9zaW1wbGUgc2xpZGVyXG4gICAgc2xpZGVyLnNldEF0dHJpYnV0ZSgndHlwZScsICdyYW5nZScpO1xuICAgIC8vc2xpZGVyLmlkID0gaWQ7XG4gICAgc2xpZGVyLmNsYXNzTmFtZSA9ICdwYXJhbWV0ZXInICsgJyAnICsgY2xhc3NOYW1lO1xuICAgIHNsaWRlci5taW4gPSBtaW47XG4gICAgc2xpZGVyLm1heCA9IG1heDtcbiAgICBzbGlkZXIuc3RlcCA9IHN0ZXA7XG4gICAgc2xpZGVyLnZhbHVlID0gdmFsdWU7XG5cblxuICAgIC8vYWR2YW5jZWQgc2xpZGVyXG4gICAgaWYoYWR2YW5jZWQpIHtcbiAgICAgIC8vY3JlYXRlIGh0bWwgZWxlbWVudHNcbiAgICAgIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICAgIHZhbHVlSW5kaWNhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgIHZhbHVlSW5kaWNhdG9yLmNsYXNzTmFtZSA9ICdwYXJhbWV0ZXInO1xuXG4gICAgICAvL2xhYmVsXG4gICAgICBsYWJlbC50ZXh0Q29udGVudCA9IGxhYmVsVGV4dDtcblxuXG4gICAgICAvL3ZhbHVlIGluZGljYXRvclxuICAgICAgdmFsdWVJbmRpY2F0b3IuaWQgPSBpZDtcbiAgICAgIHZhbHVlSW5kaWNhdG9yLnNldEF0dHJpYnV0ZSgndHlwZScsICdudW1iZXInKTtcbiAgICAgIHZhbHVlSW5kaWNhdG9yLm1pbiA9IG1pbjtcbiAgICAgIHZhbHVlSW5kaWNhdG9yLm1heCA9IG1heDtcbiAgICAgIHZhbHVlSW5kaWNhdG9yLnZhbHVlID0gdmFsdWU7XG4gICAgICB2YWx1ZUluZGljYXRvci5zdGVwID0gc3RlcDtcbiAgICAgIHZhbHVlSW5kaWNhdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHtcbiAgICAgICAgc2xpZGVyLnZhbHVlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICB9LCBmYWxzZSk7XG5cblxuICAgICAgLy9zbGlkZXJcbiAgICAgIHNsaWRlci5jbGFzc0xpc3QucmVtb3ZlKCdwYXJhbWV0ZXInKTtcbiAgICAgIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKT0+e1xuICAgICAgICB2YWx1ZUluZGljYXRvci52YWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICB2YWx1ZUluZGljYXRvci5kaXNwYXRjaEV2ZW50KG5ldyBNb3VzZUV2ZW50KCdpbnB1dCcpKTtcbiAgICAgIH0sIGZhbHNlKTtcblxuICAgICAgcmV0dXJuIHtzbGlkZXIsIGxhYmVsLCB2YWx1ZUluZGljYXRvcn07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtzbGlkZXJ9O1xuICB9XG5cblxuICBzdGF0aWMgY3JlYXRlU2VsZWN0KHtpZCwgbGFiZWxUZXh0LCBvcHRpb25zPVtdfSA9IHt9KSB7XG4gICAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpO1xuICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gICAgc2VsZWN0LmlkID0gaWQ7XG4gICAgc2VsZWN0LmNsYXNzTmFtZSA9ICdwYXJhbWV0ZXInO1xuICAgIGxhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgaWQpO1xuICAgIGxhYmVsLnRleHRDb250ZW50ID0gbGFiZWxUZXh0O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IG9wdGlvbiA9IHNlbGVjdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKSk7XG4gICAgICBvcHRpb24udmFsdWUgPSBvcHRpb25zW2ldO1xuICAgICAgb3B0aW9uLmlubmVySFRNTCA9IG9wdGlvbnNbaV07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtzZWxlY3QsIGxhYmVsfTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVOdW1lcmljVGV4dEJveCh7aWQsIGxhYmVsVGV4dCwgbWluID0gMCwgbWF4ID0gMSwgdmFsdWUgPSAxfSA9IHt9KSB7XG4gICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGlucHV0LmlkID0gaWQ7XG4gICAgaW5wdXQuY2xhc3NOYW1lID0gJ3BhcmFtZXRlcic7XG4gICAgaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ251bWJlcicpO1xuICAgIGlucHV0Lm1pbiA9IG1pbjtcbiAgICBpbnB1dC5tYXggPSBtYXg7XG4gICAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcbiAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGlkKTtcbiAgICBsYWJlbC50ZXh0Q29udGVudCA9IGxhYmVsVGV4dDtcblxuICAgIHJldHVybiB7aW5wdXQsIGxhYmVsfTtcbiAgfVxuXG5cbiAgc3RhdGljIGNyZWF0ZUNoZWNrQm94KHtpZCwgbGFiZWxUZXh0LCBjbGFzc05hbWV9ID0ge30pIHtcbiAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG5cbiAgICBpbnB1dC5pZCA9IGlkO1xuICAgIGlucHV0LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnY2hlY2tib3gnKTtcblxuICAgIGxhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgaWQpO1xuICAgIGxhYmVsLmlubmVySFRNTCA9IGxhYmVsVGV4dDtcblxuICAgIHJldHVybiB7aW5wdXQsIGxhYmVsfTtcblxuICB9XG59XG4iXX0=